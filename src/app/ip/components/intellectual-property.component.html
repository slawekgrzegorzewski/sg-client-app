<div class="sg-flex-justify-center">
  <div style="width: 1200px">
    <div class="sg-flex-row sg-flex-justify-space-between">
      <button class="btn btn-sm btn-link" (click)="openIntellectualPropertyCreationModal();">
        stwórz własność intelektualną
      </button>
      <div class="form-group row">
        <label for="filter" class="col-form-label" style="margin-right: 10px;width: 75px;">pokaż</label>
        <select id="filter" class="form-select" [(ngModel)]="intellectualPropertiesFilter" style="width: 150px;">
          <option *ngFor="let filter of intellectualPropertiesDates" [value]="filter">{{filter}}</option>
        </select>
        <button class="btn btn-sm btn-link" (click)="activeIdsArray = []" style="width: 150px;">
          zwiń wszystkie
        </button>
      </div>
    </div>

    <ngb-accordion [activeIds]="activeIds" #accordion="ngbAccordion">
      <ngb-panel *ngFor="let intellectualProperty of intellectualPropertiesFiltered"
                 [id]="intellectualProperty.id.toString()"
                 (shown)="tabShown(intellectualProperty.id.toString())"
                 (hidden)="tabHidden(intellectualProperty.id.toString())">
        <ng-template ngbPanelTitle>
          <div class="sg-flex-row sg-flex-justify-space-between" style="width: 100%">
            <div>{{intellectualProperty.description}}</div>
            <div class="sg-flex-row">
              <button class="btn btn-sm btn-link"
                      (click)="$event.cancelBubble = true;openIntellectualPropertyEditModal(intellectualProperty);">
                edytuj IP
              </button>
              <button *ngIf="intellectualProperty.tasks.length === 0"
                      class="btn btn-sm btn-link"
                      (click)="$event.cancelBubble = true;deleteIntellectualProperty(intellectualProperty.id); accordion.collapse(intellectualProperty.id.toString());">
                usuń IP
              </button>
            </div>
          </div>
        </ng-template>
        <ng-template ngbPanelContent>
          <div>
            <div class="sg-flex-row sg-flex-justify-space-between">
              <span *ngIf="intellectualProperty.tasks.length !== 0">Zadania w ramach IP</span>
              <span *ngIf="intellectualProperty.tasks.length === 0">Brak wykonanych zadań w ramach IP</span>
              <button *ngIf="!taskToEdit" (click)="showTaskCreator(intellectualProperty)" class="btn btn-sm btn-link">
                nowe zadanie
              </button>
            </div>
            <div *ngFor="let task of intellectualProperty.tasks" class="task-row sg-flex-row">
              <app-intellectual-property-task-editor
                *ngIf="displayTaskEditor(task)"
                [style]="{'margin-left': '50px', 'background-color': '#acb2ec'}"
                [intellectualProperty]="intellectualProperty"
                [taskData]="taskToEdit"
                (onAction)="taskAction($event)"
                (onCancel)="cancelTaskEdition()">
              </app-intellectual-property-task-editor>

              <div *ngIf="!taskToEdit || taskToEdit.id !== task.id" class="sg-flex-column" style="width: 100%;">
                <div class="sg-flex-row sg-flex-justify-space-between">
                  <div>{{ task.description }}</div>
                  <div>
                    <button class="btn btn-sm btn-link" (click)="showTaskEditor(task)">edytuj zadanie
                    </button>
                    <button class="btn btn-sm btn-link" *ngIf="task.timeRecords.length === 0"
                            (click)="deleteTask(task.id)">usuń zadanie
                    </button>
                  </div>
                </div>
                <div>Współautorzy: {{ task.coAuthors }}</div>
                <div *ngIf="!taskToEdit || taskToEdit.id !== task.id">
                  <div class="sg-flex-row">
                    <div class="sg-flex-column col-6"
                         style="border-right: #8e8e8e dotted; padding-right: 5px; margin-right: 5px">
                      <div class="sg-flex-row">
                        <div *ngIf="task.timeRecords.length === 0">Brak zarejestrowanego czasu</div>
                        <div *ngIf="task.timeRecords.length > 0">Zarejestrowany czas</div>
                        <button class="btn btn-sm btn-link" (click)="showTimeRecordCreator(task)">stwórz raport
                          czasu
                        </button>
                      </div>
                      <div *ngFor="let timeRecord of task.timeRecords" class="sg-flex-row">
                        <app-time-record-editor *ngIf="timeRecordToEdit && timeRecordToEdit.id === timeRecord.id"
                                                [task]="task"
                                                [timeRecord]="timeRecordToEdit"
                                                (onAction)="timeRecordAction($event)"
                                                (onCancel)="cancelTimeRecordEdition()">
                        </app-time-record-editor>
                        <div *ngIf="!timeRecordToEdit">
                          <div>{{timeRecord.date | localizedDate}}: {{timeRecord.numberOfHours}} godzin
                            - {{timeRecord.description}}</div>
                          <button class="btn btn-sm btn-link" (click)="showTimeRecordEditor(task, timeRecord)">
                            edytuj wpis
                          </button>
                          <button class="btn btn-sm btn-link" (click)="deleteTimeRecord(timeRecord.id)">usuń
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="sg-flex-column col-6" *ngIf="!attachmentData || attachmentData.taskId !== task.id">
                      <div class="sg-flex-row">
                        <div *ngIf="task.attachments.length === 0">Brak załączników</div>
                        <div *ngIf="task.attachments.length > 0">Załączniki</div>
                        <button class="btn btn-sm btn-link" (click)="showAttachmentUpload(task.id)">dodaj załązcznik
                        </button>
                      </div>
                      <div *ngFor="let attachment of task.attachments">
                        <div class="sg-flex-row">
                          <div>{{attachment}}</div>
                          <button class="btn btn-sm btn-link" (click)="downloadAttachment(task, attachment)">
                            pobierz załącznik
                          </button>
                          <button class="btn btn-sm btn-link" (click)="deleteAttachment(task, attachment)">usuń
                            załącznik
                          </button>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="attachmentData && attachmentData.taskId === task.id">
                      <sg-uploader [uploadFunction]="upload()"
                                   (uploadFinished)="attachmentData = null;refreshData()"
                                   (uploadCancelled)="attachmentData = null;refreshData();"></sg-uploader>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </ngb-panel>
    </ngb-accordion>
  </div>
</div>
