<div class="row col-sm sg-flex-justify-center">
  <ng-container *ngTemplateOutlet="piggyBanksTemplate"></ng-container>
</div>

<ng-template #piggyBanksTemplate>
  <div class="sg-flex-column">
    <h5 *ngIf="title" style="text-align: center">{{title}}</h5>
    <div *ngIf="isNonEditMode()" class="sg-flex-row sg-flex-justify-center">
      <table>
        <thead>
        <tr>
          <td style="width: 100px">Data</td>
          <td style="width: 100px">Klient</td>
          <td style="width: 100px">Usługa</td>
          <td style="width: 100px">Cena</td>
        </tr>
        </thead>
        <ng-container *ngFor="let performedService of performedServices">
          <tr #row [ngClass]="getPerformedServiceClass(performedService)"
              (click)="setPerformedService(performedService)"
              class="performed-service-row sg-row-hoverable">
            <td>{{performedService.date | localizedDate }}</td>
            <td>{{performedService.client.name}}</td>
            <td>{{performedService.service.name}}</td>
            <td style="text-align:right">{{performedService.price| currency: performedService.currency}}</td>
          </tr>

          <tr *ngIf="isEqualToSelectedElement(performedService)"
              [ngClass]="getPerformedServiceClass(performedService)"
              (click)="setPerformedService(performedService)">
            <td colspan="4">
              <div class="sg-flex-column">
                <div class="sg-flex-row sg-flex-justify-flex-end">
                  <button (click)="prepareToGeneralEdit()" class="btn btn-link btn-sm">
                    Edytuj
                  </button>
                  <button (click)="prepareToPaymentSelectionEdit()" *ngIf="serviceNeedsPayment()"
                          class="btn btn-link btn-sm">
                    Opłać
                  </button>
                </div>
                <table style="width: 100%">
                  <thead>
                  <tr>
                    <td>Data</td>
                    <td>Cena</td>
                    <td style="width: 30px">P</td>
                    <td style="width: 30px">PF</td>
                    <td style="width: 30px">F</td>
                  </tr>
                  </thead>
                  <tr *ngFor="let payment of performedService.clientPaymentsRelations">
                    <td style="text-align:center">{{clientPayment(payment).date | localizedDate}}</td>
                    <td style="text-align:right">{{payment.price | currency: clientPayment(payment).currency}}</td>
                    <td style="text-align:center">
                      <input type="checkbox" [ngModel]="clientPayment(payment).billOfSale" disabled>
                    </td>
                    <td style="text-align:center">
                      <input type="checkbox" [ngModel]="clientPayment(payment).billOfSaleAsInvoice" disabled>
                    </td>
                    <td style="text-align:center">
                      <input type="checkbox" [ngModel]="clientPayment(payment).invoice" disabled>
                    </td>
                  </tr>
                </table>
              </div>
            </td>
          </tr>
        </ng-container>
      </table>
    </div>

    <app-performed-service-edit *ngIf="isGeneralEditMode() || isCreateEditMode()"
                                [performedService]="editElement"
                                [editMode]="isGeneralEditMode()"
                                [createMode]="isCreateEditMode()"
                                [services]="services"
                                [clients]="clients"
                                [allCurrencies]="allCurrencies"
                                (updateEvent)="update($event)"
                                (createEvent)="create($event)"
                                (cancelEvent)="resetEditForm()"
    ></app-performed-service-edit>
    <app-payment-selection *ngIf="isPaymentSelectionEditMode()"
                           [forService]="selectedElement"
                           [payments]="clientPayments"
                           [maxPrice]="getLackingAmount()"
                           (createEvent)="createPerformedServicePayment($event)"
                           (cancelEvent)="resetEditForm()">
    </app-payment-selection>

    <div class="sg-flex-row sg-flex-justify-center">
      <button (click)="prepareToCreate()" *ngIf="isNonEditMode()" class="btn btn-primary">Stwórz</button>
    </div>
  </div>
</ng-template>
